<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="العثور على أقرب فرع LG في مصر - خدمة محسّنة للبحث عن فروع إل جي بالمسافة والموقع">
    <meta name="keywords" content="LG مصر، فروع LG، خدمة عملاء LG، أقرب فرع LG، إل جي مصر">
    <meta name="author" content="LG Electronics Egypt">
    <meta property="og:title" content="العثور على أقرب فرع LG - مصر">
    <meta property="og:description" content="ابحث عن أقرب فرع LG إليك في مصر مع تجربة محسّنة">
    <meta property="og:type" content="website">
    <meta name="robots" content="index, follow">
    
    <title>العثور على أقرب فرع LG - مصر</title>
    
    <style>
        /* Enhanced Color Palette with Better Harmony */
        :root {
            /* Brand Colors */
            --lg-red: #C70851;
            --lg-red-dark: #A50034;
            --lg-red-light: #E63976;
            --lg-gray: #6B6B6B;
            --lg-light-gray: #D9DADB;
            --lg-dark: #1D1D1B;
            --lg-purple: #B150C5;
            --lg-silver: #8A8C8F;
            --lg-gold: #B49759;
            
            /* Harmonious Color Palette */
            --primary-50: #FDF2F8;
            --primary-100: #FCE7F3;
            --primary-200: #FBCFE8;
            --primary-300: #F9A8D4;
            --primary-400: #F472B6;
            --primary-500: var(--lg-red);
            --primary-600: var(--lg-red-dark);
            --primary-700: #BE185D;
            --primary-800: #9D174D;
            --primary-900: #831843;
            
            --secondary-50: #F8FAFC;
            --secondary-100: #F1F5F9;
            --secondary-200: #E2E8F0;
            --secondary-300: #CBD5E1;
            --secondary-400: #94A3B8;
            --secondary-500: #64748B;
            --secondary-600: #475569;
            --secondary-700: #334155;
            --secondary-800: #1E293B;
            --secondary-900: #0F172A;
            
            --accent-50: #FAF5FF;
            --accent-100: #F3E8FF;
            --accent-200: #E9D5FF;
            --accent-300: #D8B4FE;
            --accent-400: #C084FC;
            --accent-500: var(--lg-purple);
            --accent-600: #9333EA;
            --accent-700: #7C3AED;
            --accent-800: #6D28D9;
            --accent-900: #5B21B6;
            
            --success-50: #F0FDF4;
            --success-100: #DCFCE7;
            --success-200: #BBF7D0;
            --success-300: #86EFAC;
            --success-400: #4ADE80;
            --success-500: #22C55E;
            --success-600: #16A34A;
            --success-700: #15803D;
            --success-800: #166534;
            --success-900: #14532D;
            
            --warning-50: #FFFBEB;
            --warning-100: #FEF3C7;
            --warning-200: #FDE68A;
            --warning-300: #FCD34D;
            --warning-400: #FBBF24;
            --warning-500: #F59E0B;
            --warning-600: #D97706;
            --warning-700: #B45309;
            --warning-800: #92400E;
            --warning-900: #78350F;
            
            --error-50: #FEF2F2;
            --error-100: #FEE2E2;
            --error-200: #FECACA;
            --error-300: #FCA5A5;
            --error-400: #F87171;
            --error-500: #EF4444;
            --error-600: #DC2626;
            --error-700: #B91C1C;
            --error-800: #991B1B;
            --error-900: #7F1D1D;
            
            /* Light/Dark Theme Variables */
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-tertiary: #F1F5F9;
            --text-primary: var(--secondary-900);
            --text-secondary: var(--secondary-600);
            --text-tertiary: var(--secondary-400);
            --border-color: var(--secondary-200);
            --shadow-color: rgba(15, 23, 42, 0.1);
            
            /* Transitions */
            --transition-fast: 0.15s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --bg-primary: var(--secondary-900);
            --bg-secondary: var(--secondary-800);
            --bg-tertiary: var(--secondary-700);
            --text-primary: var(--secondary-100);
            --text-secondary: var(--secondary-300);
            --text-tertiary: var(--secondary-400);
            --border-color: var(--secondary-600);
            --shadow-color: rgba(0, 0, 0, 0.3);
        }

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--primary-50) 0%, var(--accent-50) 100%);
            min-height: 100vh;
            color: var(--text-primary);
            direction: rtl;
            text-align: right;
            line-height: 1.6;
            font-size: 16px;
            transition: background-color var(--transition-normal), color var(--transition-normal);
        }

        [data-theme="dark"] body {
            background: linear-gradient(135deg, var(--secondary-900) 0%, var(--secondary-800) 100%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
        }

        /* Skip Link for Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--primary-500);
            color: white;
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 1000;
            transition: top var(--transition-fast);
        }

        .skip-link:focus {
            top: 6px;
        }

        /* Header Styles */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px var(--shadow-color);
            transition: background-color var(--transition-normal);
        }

        [data-theme="dark"] .header {
            background: rgba(15, 23, 42, 0.95);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .lg-logo {
            width: 150px;
            height: auto;
        }

        .main-title {
            font-size: clamp(1.5rem, 3vw, 2.25rem);
            font-weight: 800;
            color: var(--primary-500);
            margin: 0;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        /* Theme Toggle */
        .theme-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 50px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all var(--transition-normal);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
        }

        .theme-toggle:hover {
            background: var(--primary-50);
            border-color: var(--primary-200);
        }

        /* Language Toggle */
        .lang-toggle {
            background: var(--primary-500);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all var(--transition-normal);
        }

        .lang-toggle:hover {
            background: var(--primary-600);
            transform: translateY(-1px);
        }

        .subtitle {
            font-size: 1.125rem;
            color: var(--text-secondary);
            font-weight: 400;
            text-align: center;
            margin-top: 0.5rem;
        }

        /* Enhanced Card Components */
        .card {
            background: var(--bg-primary);
            border-radius: 20px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 24px var(--shadow-color);
            transition: all var(--transition-normal);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 40px var(--shadow-color);
            border-color: var(--primary-200);
        }

        /* Location Status Styles */
        .location-status {
            padding: 2rem 0;
        }

        .status-card {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1.25rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .status-icon {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            width: 56px;
            height: 56px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            box-shadow: 0 6px 20px rgba(199, 8, 81, 0.25);
        }

        .status-icon.success {
            background: linear-gradient(135deg, var(--success-500), var(--success-600));
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.25);
        }

        .status-icon.error {
            background: linear-gradient(135deg, var(--error-500), var(--error-600));
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.25);
        }

        .status-text {
            flex: 1;
        }

        .status-text p {
            font-size: 1rem;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            font-weight: 500;
            line-height: 1.5;
        }

        .location-details {
            font-size: 0.875rem;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: 8px;
            margin-top: 0.5rem;
            border: 1px solid var(--border-color);
        }

        .btn {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9375rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all var(--transition-normal);
            font-family: inherit;
            box-shadow: 0 4px 16px rgba(199, 8, 81, 0.25);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(199, 8, 81, 0.35);
        }

        .btn:focus {
            outline: 2px solid var(--primary-300);
            outline-offset: 2px;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-500), var(--success-600));
            box-shadow: 0 4px 16px rgba(34, 197, 94, 0.25);
        }

        .btn-error {
            background: linear-gradient(135deg, var(--error-500), var(--error-600));
            box-shadow: 0 4px 16px rgba(239, 68, 68, 0.25);
        }

        /* Section Titles */
        .section-title {
            font-size: clamp(1.5rem, 3vw, 2rem);
            color: var(--primary-500);
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 700;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(50%);
            width: 60px;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-500), var(--accent-500));
            border-radius: 2px;
        }

        /* Skeleton Loading */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-tertiary) 25%, var(--border-color) 50%, var(--bg-tertiary) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            border-radius: 8px;
        }

        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-card {
            padding: 1.75rem;
            height: 200px;
        }

        .skeleton-text {
            height: 1rem;
            margin-bottom: 0.75rem;
        }

        .skeleton-text.large { height: 1.5rem; }
        .skeleton-text.small { height: 0.75rem; width: 60%; }

        /* Nearest Branch Styles */
        .nearest-branch {
            padding: 2rem 0;
        }

        .nearest-card {
            background: linear-gradient(135deg, var(--primary-500), var(--primary-600));
            color: white;
            padding: 2.5rem;
            text-align: center;
            max-width: 700px;
            margin: 0 auto;
            position: relative;
            overflow: hidden;
            box-shadow: 0 16px 64px rgba(199, 8, 81, 0.3);
        }

        .branch-name {
            font-size: clamp(1.25rem, 2.5vw, 1.75rem);
            font-weight: 700;
            margin-bottom: 1rem;
            position: relative;
            z-index: 1;
        }

        .branch-distance {
            font-size: 1.375rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.15);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        /* All Branches Styles */
        .all-branches {
            padding: 2rem 0 4rem;
        }

        .search-container {
            max-width: 500px;
            margin: 0 auto 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1rem 3rem 1rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            font-size: 1rem;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all var(--transition-normal);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 3px var(--primary-100);
        }

        .search-icon {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            pointer-events: none;
        }

        .branches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .branch-card {
            padding: 1.75rem;
            position: relative;
            overflow: hidden;
        }

        .branch-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, var(--primary-500), var(--accent-500));
        }

        .branch-card .branch-name {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .branch-address {
            color: var(--text-secondary);
            font-size: 0.9375rem;
            margin-bottom: 1.25rem;
            line-height: 1.6;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .branch-contact {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9375rem;
            color: var(--text-primary);
            padding: 0.5rem 0.75rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .contact-icon {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            color: var(--primary-600);
        }

        .maps-link {
            background: linear-gradient(135deg, var(--accent-500), var(--accent-600));
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            text-decoration: none;
            font-size: 0.9375rem;
            font-weight: 600;
            text-align: center;
            margin-top: 1.25rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all var(--transition-normal);
            box-shadow: 0 4px 16px rgba(147, 51, 234, 0.25);
        }

        .maps-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(147, 51, 234, 0.35);
        }

        .branch-card .branch-distance {
            color: var(--primary-600);
            font-weight: 600;
            font-size: 1.125rem;
            margin-bottom: 1rem;
            justify-content: flex-start;
            background: var(--primary-50);
            padding: 0.5rem 1rem;
            border-radius: 8px;
        }

        [data-theme="dark"] .branch-card .branch-distance {
            background: var(--primary-900);
        }

        /* Footer */
        .footer {
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
            padding: 3rem 0 2rem;
            margin-top: 3rem;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .footer-logo {
            width: 120px;
            height: auto;
            opacity: 0.8;
        }

        .social-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            text-decoration: none;
            transition: all var(--transition-normal);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .social-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px var(--shadow-color);
            border-color: var(--primary-300);
            color: var(--primary-500);
        }

        .footer-text {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Error Section */
        .error-section {
            padding: 4rem 0;
        }

        .error-card {
            padding: 3rem 2rem;
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .error-icon {
            color: var(--error-500);
            margin-bottom: 1.5rem;
        }

        .error-card h3 {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .error-card p {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .header-controls {
                order: -1;
                width: 100%;
                justify-content: center;
            }
            
            .lg-logo {
                width: 120px;
            }
            
            .branches-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .branch-card {
                padding: 1.25rem;
            }
            
            .nearest-card {
                padding: 1.75rem;
                margin: 0 16px;
            }
            
            .status-card {
                margin: 0 16px;
                padding: 1.25rem;
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }

            .status-icon {
                width: 48px;
                height: 48px;
            }

            .social-links {
                gap: 0.75rem;
            }

            .social-link {
                width: 40px;
                height: 40px;
            }
        }

        @media (max-width: 480px) {
            .nearest-card {
                padding: 1.25rem;
            }
            
            .branch-card {
                padding: 1rem;
            }

            .search-input {
                padding: 0.875rem 2.5rem 0.875rem 0.875rem;
            }
        }

        /* Accessibility and Animation Preferences */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        @media (prefers-contrast: high) {
            .card {
                border: 2px solid var(--text-primary);
            }
            
            .btn {
                border: 2px solid var(--text-primary);
            }
        }

        /* Enhanced animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Enhanced focus styles */
        *:focus {
            outline: 2px solid var(--primary-500);
            outline-offset: 2px;
        }

        /* Loading States */
        .loading-skeleton {
            padding: 2rem 0;
        }

        .skeleton-branches {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        /* Screen Reader Only */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <!-- Skip to main content link for accessibility -->
    <a href="#main-content" class="skip-link">الانتقال إلى المحتوى الرئيسي</a>

    <!-- Header Section -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header-content">
                <div class="header-controls">
                    <button class="theme-toggle" id="themeToggle" aria-label="تبديل الوضع الليلي">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75zM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0zM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59zM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75zM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591zM12 18a.75.75 0 0 1 .75.75V21a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18zM7.758 17.303a.75.75 0 0 0-1.061-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59zM6 12a.75.75 0 0 1-.75.75H3a.75.75 0 0 1 0-1.5h2.25A.75.75 0 0 1 6 12zM6.697 7.757a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591z"/>
                        </svg>
                    </button>
                    <button class="lang-toggle" id="langToggle" aria-label="تغيير اللغة">EN</button>
                </div>
                
                <div class="logo-container">
                    <svg class="lg-logo" viewBox="0 0 225 99" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="شعار LG">
                        <g clip-path="url(#clip0_415_130964)">
                            <path d="M134.874 68.7831H165.274V81.2487H120.202V17.2373H134.874V68.7831Z" fill="#707070"/>
                            <path d="M197.534 56.8451H209.482V68.0462C207.288 68.8892 202.987 69.7323 198.905 69.7323C185.694 69.7323 181.301 62.9711 181.301 49.241C181.301 36.1374 185.483 28.4265 198.682 28.4265C206.039 28.4265 210.213 30.7533 213.675 35.1904L222.802 26.7376C217.227 18.726 207.5 16.2981 198.365 16.2981C177.83 16.2897 167.033 27.5807 167.033 49.1314C167.033 70.5753 176.79 82.2007 198.256 82.2007C208.113 82.2007 217.748 79.6716 222.992 75.9651V44.9078H197.534V56.8451Z" fill="#707070"/>
                            <path d="M83.831 84.5045C103.008 65.1736 103.007 33.831 83.829 14.499C64.6508 -4.83307 33.5576 -4.83396 14.3805 14.497C-4.79664 33.8279 -4.79576 65.1705 14.3825 84.5025C33.5607 103.835 64.6538 103.835 83.831 84.5045Z" fill="#A50034"/>
                            <path d="M61.1184 66.6079H51.0826V28.5984H47.3721V70.3594H51.0909V70.3341H61.1268L61.1184 66.6079Z" fill="white"/>
                            <path d="M86.1485 51.0737H61.1759V47.3447H89.8088C89.8479 48.0669 89.8674 48.7891 89.8674 49.5198C89.8674 71.9725 71.7136 90.1707 49.3252 90.1707C26.9368 90.1707 8.78027 71.9809 8.78027 49.5169C8.78027 27.053 26.9313 8.86597 49.3224 8.86597C49.9134 8.86597 50.5016 8.87814 51.0871 8.9025V12.6034C50.5016 12.5772 49.9153 12.5641 49.328 12.5641C28.9775 12.5641 12.474 29.11 12.474 49.5169C12.474 69.9239 28.9747 86.4726 49.328 86.4726C69.121 86.4726 85.2899 70.8175 86.1457 51.1777L86.1485 51.0737Z" fill="white"/>
                            <path d="M34.2066 39.8496C35.3263 39.8441 36.4193 39.5043 37.3476 38.8732C38.276 38.2421 38.9981 37.3479 39.4227 36.3036C39.8474 35.2592 39.9557 34.1114 39.7339 33.005C39.5121 31.8987 38.9701 30.8834 38.1764 30.0872C37.3827 29.2911 36.3728 28.7497 35.2742 28.5316C34.1756 28.3134 33.0374 28.4282 32.0035 28.8614C30.9695 29.2946 30.086 30.0268 29.4645 30.9657C28.8429 31.9046 28.5112 33.008 28.5112 34.1367C28.5131 34.8888 28.6618 35.6331 28.949 36.3273C29.2362 37.0214 29.6563 37.6517 30.1851 38.1822C30.714 38.7127 31.3413 39.133 32.0313 39.4191C32.7213 39.7052 33.4605 39.8515 34.2066 39.8496Z" fill="white"/>
                        </g>
                        <defs>
                            <clipPath id="clip0_415_130964">
                                <rect width="223" height="99" fill="white"/>
                            </clipPath>
                        </defs>
                    </svg>
                    <div>
                        <h1 class="main-title" id="page-title">العثور على أقرب فرع LG</h1>
                        <p class="subtitle">ابحث عن أقرب فرع LG إليك في مصر مع تجربة محسّنة</p>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" role="main">
        <!-- Location Status Section -->
        <section class="location-status" id="locationStatus" aria-labelledby="location-status-title">
            <div class="container">
                <h2 id="location-status-title" class="sr-only">حالة الموقع</h2>
                <div class="status-card card">
                    <div class="status-icon" id="statusIcon" aria-hidden="true">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                        </svg>
                    </div>
                    <div class="status-text">
                        <p id="statusMessage">جاري تحديد موقعك...</p>
                        <div id="locationDetails" class="location-details" style="display: none;"></div>
                        <button id="refreshLocationBtn" class="btn" style="display: none;" aria-label="إعادة تحديد الموقع">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            تحديث الموقع
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Nearest Branch Section -->
        <section class="nearest-branch" id="nearestBranchSection" style="display: none;" aria-labelledby="nearest-branch-title">
            <div class="container">
                <h2 class="section-title" id="nearest-branch-title">أقرب فرع إليك</h2>
                <div class="nearest-card card" id="nearestCard">
                    <!-- سيتم ملؤها بالجافاسكريبت -->
                </div>
            </div>
        </section>

        <!-- Skeleton Loading for All Branches -->
        <section class="loading-skeleton" id="loadingSkeletonSection">
            <div class="container">
                <h2 class="section-title">جاري تحميل الفروع...</h2>
                <div class="skeleton-branches" id="skeletonGrid">
                    <div class="skeleton-card card">
                        <div class="skeleton skeleton-text large"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text small"></div>
                        <div class="skeleton skeleton-text"></div>
                    </div>
                    <div class="skeleton-card card">
                        <div class="skeleton skeleton-text large"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text small"></div>
                        <div class="skeleton skeleton-text"></div>
                    </div>
                    <div class="skeleton-card card">
                        <div class="skeleton skeleton-text large"></div>
                        <div class="skeleton skeleton-text"></div>
                        <div class="skeleton skeleton-text small"></div>
                        <div class="skeleton skeleton-text"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- All Branches Section -->
        <section class="all-branches" id="allBranchesSection" style="display: none;" aria-labelledby="all-branches-title">
            <div class="container">
                <h2 class="section-title" id="all-branches-title">جميع الفروع مرتبة حسب المسافة</h2>
                
                <!-- Search Input -->
                <div class="search-container">
                    <label for="searchInput" class="sr-only">البحث في الفروع</label>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="ابحث عن فرع بالاسم أو المنطقة..."
                        aria-label="البحث في الفروع"
                        autocomplete="off"
                    >
                    <div class="search-icon" aria-hidden="true">
                        <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </div>
                </div>

                <div class="branches-grid" id="branchesGrid" role="list" aria-label="قائمة فروع LG">
                    <!-- سيتم ملؤها بالجافاسكريبت -->
                </div>
            </div>
        </section>

        <!-- Error Section -->
        <section class="error-section" id="errorSection" style="display: none;" aria-labelledby="error-title">
            <div class="container">
                <div class="error-card card">
                    <div class="error-icon" aria-hidden="true">
                        <svg width="48" height="48" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                    </div>
                    <h3 id="error-title">عذراً، حدث خطأ</h3>
                    <p id="errorMessage">لا يمكن تحميل بيانات الفروع</p>
                    <button id="retryBtn" class="btn btn-error">إعادة المحاولة</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <svg class="footer-logo" viewBox="0 0 225 99" fill="none" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="شعار LG">
                    <g clip-path="url(#clip0_415_130964)">
                        <path d="M134.874 68.7831H165.274V81.2487H120.202V17.2373H134.874V68.7831Z" fill="currentColor"/>
                        <path d="M197.534 56.8451H209.482V68.0462C207.288 68.8892 202.987 69.7323 198.905 69.7323C185.694 69.7323 181.301 62.9711 181.301 49.241C181.301 36.1374 185.483 28.4265 198.682 28.4265C206.039 28.4265 210.213 30.7533 213.675 35.1904L222.802 26.7376C217.227 18.726 207.5 16.2981 198.365 16.2981C177.83 16.2897 167.033 27.5807 167.033 49.1314C167.033 70.5753 176.79 82.2007 198.256 82.2007C208.113 82.2007 217.748 79.6716 222.992 75.9651V44.9078H197.534V56.8451Z" fill="currentColor"/>
                        <path d="M83.831 84.5045C103.008 65.1736 103.007 33.831 83.829 14.499C64.6508 -4.83307 33.5576 -4.83396 14.3805 14.497C-4.79664 33.8279 -4.79576 65.1705 14.3825 84.5025C33.5607 103.835 64.6538 103.835 83.831 84.5045Z" fill="#A50034"/>
                        <path d="M61.1184 66.6079H51.0826V28.5984H47.3721V70.3594H51.0909V70.3341H61.1268L61.1184 66.6079Z" fill="white"/>
                        <path d="M86.1485 51.0737H61.1759V47.3447H89.8088C89.8479 48.0669 89.8674 48.7891 89.8674 49.5198C89.8674 71.9725 71.7136 90.1707 49.3252 90.1707C26.9368 90.1707 8.78027 71.9809 8.78027 49.5169C8.78027 27.053 26.9313 8.86597 49.3224 8.86597C49.9134 8.86597 50.5016 8.87814 51.0871 8.9025V12.6034C50.5016 12.5772 49.9153 12.5641 49.328 12.5641C28.9775 12.5641 12.474 29.11 12.474 49.5169C12.474 69.9239 28.9747 86.4726 49.328 86.4726C69.121 86.4726 85.2899 70.8175 86.1457 51.1777L86.1485 51.0737Z" fill="white"/>
                        <path d="M34.2066 39.8496C35.3263 39.8441 36.4193 39.5043 37.3476 38.8732C38.276 38.2421 38.9981 37.3479 39.4227 36.3036C39.8474 35.2592 39.9557 34.1114 39.7339 33.005C39.5121 31.8987 38.9701 30.8834 38.1764 30.0872C37.3827 29.2911 36.3728 28.7497 35.2742 28.5316C34.1756 28.3134 33.0374 28.4282 32.0035 28.8614C30.9695 29.2946 30.086 30.0268 29.4645 30.9657C28.8429 31.9046 28.5112 33.008 28.5112 34.1367C28.5131 34.8888 28.6618 35.6331 28.949 36.3273C29.2362 37.0214 29.6563 37.6517 30.1851 38.1822C30.714 38.7127 31.3413 39.133 32.0313 39.4191C32.7213 39.7052 33.4605 39.8515 34.2066 39.8496Z" fill="white"/>
                    </g>
                    <defs>
                        <clipPath id="clip0_415_130964">
                            <rect width="223" height="99" fill="white"/>
                        </clipPath>
                    </defs>
                </svg>

                <!-- Social Media Links -->
                <nav aria-label="روابط وسائل التواصل الاجتماعي">
                    <div class="social-links">
                        <a href="https://www.facebook.com/LGEgypt/" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="فيسبوك LG مصر">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M22 12a10 10 0 1 0-11.5 9.9v-7h-2v-3h2v-2.3c0-2 1.2-3.2 3-3.2 .9 0 1.8.1 1.8.1v2h-1c-1 0-1.3.6-1.3 1.2V12h2.5l-.4 3h-2.1v7A10 10 0 0 0 22 12"/>
                            </svg>
                        </a>
                        <a href="https://x.com/LGEEgypt" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="تويتر LG مصر">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                        </a>
                        <a href="https://www.instagram.com/lgegypt/" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="انستغرام LG مصر">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                        <a href="https://www.tiktok.com/@lgeegypt" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="تيك توك LG مصر">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
                            </svg>
                        </a>
                        <a href="https://www.youtube.com/channel/UCKJ1b02mIPF8wWWPstBwBCw" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="يوتيوب LG مصر">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                            </svg>
                        </a>
                        <a href="https://www.lg.com/eg_en/" target="_blank" rel="noopener noreferrer" class="social-link" aria-label="موقع LG الرسمي">
                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.94-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                            </svg>
                        </a>
                    </div>
                </nav>

                <p class="footer-text">© 2025 LG Electronics. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <script>
        /**
         * Enhanced LG Branches Finder - Main JavaScript File
         * Features: Caching, Dark Mode, Language Toggle, Enhanced Accessibility
         */

        // Global variables
        let userLocation = null;
        let branchesData = [];
        let filteredBranches = [];
        let isLocationPermissionGranted = false;
        let currentLanguage = 'ar';
        let branchesCache = null;
        let cacheExpiry = null;

        // Cache settings (5 minutes)
        const CACHE_DURATION = 5 * 60 * 1000;

        // DOM elements
        const elements = {
            themeToggle: document.getElementById('themeToggle'),
            langToggle: document.getElementById('langToggle'),
            locationStatus: document.getElementById('locationStatus'),
            statusMessage: document.getElementById('statusMessage'),
            statusIcon: document.getElementById('statusIcon'),
            locationDetails: document.getElementById('locationDetails'),
            refreshLocationBtn: document.getElementById('refreshLocationBtn'),
            nearestBranchSection: document.getElementById('nearestBranchSection'),
            nearestCard: document.getElementById('nearestCard'),
            loadingSkeletonSection: document.getElementById('loadingSkeletonSection'),
            allBranchesSection: document.getElementById('allBranchesSection'),
            branchesGrid: document.getElementById('branchesGrid'),
            errorSection: document.getElementById('errorSection'),
            errorMessage: document.getElementById('errorMessage'),
            retryBtn: document.getElementById('retryBtn'),
            searchInput: document.getElementById('searchInput'),
            pageTitle: document.getElementById('page-title')
        };

        // Messages in Arabic and English
        const messages = {
            ar: {
                locating: 'جاري تحديد موقعك...',
                locationSuccess: 'تم تحديد موقعك بنجاح',
                locationDenied: 'من فضلك اسمح بمشاركة الموقع ليتم عرض أقرب فرع',
                locationError: 'حدث خطأ في تحديد الموقع',
                locationUnavailable: 'خدمة تحديد الموقع غير متاحة',
                dataError: 'خطأ في تحميل بيانات الفروع',
                noCoordinates: 'نعتذر، لا توجد إحداثيات لبعض الفروع',
                networkError: 'خطأ في الاتصال بالشبكة',
                nearestBranch: 'أقرب فرع إليك',
                allBranches: 'جميع الفروع مرتبة حسب المسافة',
                allBranchesNoDistance: 'جميع الفروع',
                searchPlaceholder: 'ابحث عن فرع بالاسم أو المنطقة...',
                loadingBranches: 'جاري تحميل الفروع...',
                viewOnMap: 'عرض في الخرائط',
                retry: 'إعادة المحاولة',
                updateLocation: 'تحديث الموقع',
                youAreAt: 'أنت الآن في:',
                nearestIs: 'أقرب فرع لك هو:'
            },
            en: {
                locating: 'Locating your position...',
                locationSuccess: 'Location detected successfully',
                locationDenied: 'Please allow location sharing to show nearest branch',
                locationError: 'Error detecting location',
                locationUnavailable: 'Location service unavailable',
                dataError: 'Error loading branches data',
                noCoordinates: 'Sorry, coordinates unavailable for some branches',
                networkError: 'Network connection error',
                nearestBranch: 'Nearest Branch to You',
                allBranches: 'All Branches Sorted by Distance',
                allBranchesNoDistance: 'All Branches',
                searchPlaceholder: 'Search for branch by name or area...',
                loadingBranches: 'Loading branches...',
                viewOnMap: 'View on Map',
                retry: 'Retry',
                updateLocation: 'Update Location',
                youAreAt: 'You are currently at:',
                nearestIs: 'Nearest branch to you is:'
            }
        };

        // Theme management
        const themeManager = {
            init() {
                const savedTheme = localStorage.getItem('lg-finder-theme') || 'light';
                this.setTheme(savedTheme);
                elements.themeToggle.addEventListener('click', () => this.toggle());
            },
            
            setTheme(theme) {
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('lg-finder-theme', theme);
                this.updateThemeIcon(theme);
            },
            
            toggle() {
                const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                this.setTheme(newTheme);
            },
            
            updateThemeIcon(theme) {
                const icon = theme === 'dark' ? 
                    '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M21.752 15.002A9.718 9.718 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998z"/></svg>' :
                    '<svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75zM7.5 12a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0zM18.894 6.166a.75.75 0 0 0-1.06-1.06l-1.591 1.59a.75.75 0 1 0 1.06 1.061l1.591-1.59zM21.75 12a.75.75 0 0 1-.75.75h-2.25a.75.75 0 0 1 0-1.5H21a.75.75 0 0 1 .75.75zM17.834 18.894a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 1 0-1.061 1.06l1.59 1.591zM12 18a.75.75 0 0 1 .75.75V21a.75.75 0 0 1-1.5 0v-2.25A.75.75 0 0 1 12 18zM7.758 17.303a.75.75 0 0 0-1.061-1.06l-1.591 1.59a.75.75 0 0 0 1.06 1.061l1.591-1.59zM6 12a.75.75 0 0 1-.75.75H3a.75.75 0 0 1 0-1.5h2.25A.75.75 0 0 1 6 12zM6.697 7.757a.75.75 0 0 0 1.06-1.06l-1.59-1.591a.75.75 0 0 0-1.061 1.06l1.59 1.591z"/></svg>';
                
                elements.themeToggle.innerHTML = icon;
                elements.themeToggle.setAttribute('aria-label', 
                    theme === 'dark' ? 'التبديل إلى الوضع النهاري' : 'التبديل إلى الوضع الليلي'
                );
            }
        };

        // Language management
        const languageManager = {
            init() {
                const savedLang = localStorage.getItem('lg-finder-lang') || 'ar';
                this.setLanguage(savedLang);
                elements.langToggle.addEventListener('click', () => this.toggle());
            },
            
            setLanguage(lang) {
                currentLanguage = lang;
                localStorage.setItem('lg-finder-lang', lang);
                
                document.documentElement.lang = lang;
                document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
                document.body.style.textAlign = lang === 'ar' ? 'right' : 'left';
                
                elements.langToggle.textContent = lang === 'ar' ? 'EN' : 'AR';
                elements.langToggle.setAttribute('aria-label', 
                    lang === 'ar' ? 'Switch to English' : 'التبديل للعربية'
                );
                
                this.updateUI();
            },
            
            toggle() {
                const newLang = currentLanguage === 'ar' ? 'en' : 'ar';
                this.setLanguage(newLang);
                
                // Re-render branches if they exist
                if (filteredBranches.length > 0) {
                    renderBranches(filteredBranches);
                    if (elements.nearestBranchSection.style.display !== 'none') {
                        updateNearestBranch(filteredBranches[0]);
                    }
                }
            },
            
            updateUI() {
                const msg = messages[currentLanguage];
                
                // Update page title
                document.title = currentLanguage === 'ar' ? 
                    'العثور على أقرب فرع LG - مصر' : 
                    'Find Nearest LG Branch - Egypt';
                
                elements.pageTitle.textContent = currentLanguage === 'ar' ? 
                    'العثور على أقرب فرع LG' : 
                    'Find Nearest LG Branch';
                
                // Update search placeholder
                elements.searchInput.placeholder = msg.searchPlaceholder;
                
                // Update section titles
                const nearestTitle = document.getElementById('nearest-branch-title');
                const allBranchesTitle = document.getElementById('all-branches-title');
                
                if (nearestTitle) nearestTitle.textContent = msg.nearestBranch;
                if (allBranchesTitle) {
                    allBranchesTitle.textContent = userLocation ? msg.allBranches : msg.allBranchesNoDistance;
                }
                
                // Update loading skeleton title
                const skeletonTitle = elements.loadingSkeletonSection.querySelector('.section-title');
                if (skeletonTitle) skeletonTitle.textContent = msg.loadingBranches;
                
                // Update buttons
                elements.refreshLocationBtn.innerHTML = `
                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                    ${msg.updateLocation}
                `;
                
                elements.retryBtn.textContent = msg.retry;
            }
        };

        // Cache management
        const cacheManager = {
            set(data) {
                branchesCache = data;
                cacheExpiry = Date.now() + CACHE_DURATION;
                try {
                    localStorage.setItem('lg-finder-cache', JSON.stringify({
                        data: data,
                        expiry: cacheExpiry
                    }));
                } catch (e) {
                    console.warn('Could not save to localStorage:', e);
                }
            },
            
            get() {
                // Check memory cache first
                if (branchesCache && cacheExpiry && Date.now() < cacheExpiry) {
                    return branchesCache;
                }
                
                // Check localStorage cache
                try {
                    const cached = localStorage.getItem('lg-finder-cache');
                    if (cached) {
                        const { data, expiry } = JSON.parse(cached);
                        if (Date.now() < expiry) {
                            branchesCache = data;
                            cacheExpiry = expiry;
                            return data;
                        }
                    }
                } catch (e) {
                    console.warn('Could not read from localStorage:', e);
                }
                
                return null;
            },
            
            clear() {
                branchesCache = null;
                cacheExpiry = null;
                try {
                    localStorage.removeItem('lg-finder-cache');
                } catch (e) {
                    console.warn('Could not clear localStorage:', e);
                }
            }
        };

        // Create SVG icons
        const createIcon = (type) => {
            const icons = {
                phone: '<svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>',
                location: '<svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>',
                navigation: '<svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>',
                distance: '<svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M13 1L22 8v2h-2v4.17L22 16v2l-9-7-9 7v-2l2-1.83V10H4V8l9-7z"/></svg>'
            };
            return icons[type] || '';
        };

        /**
         * Update location status in UI
         */
        const updateLocationStatus = (message, status = 'loading') => {
            const msg = messages[currentLanguage];
            elements.statusMessage.textContent = message;
            
            // Update icon class
            elements.statusIcon.className = `status-icon ${status}`;
            
            // Show/hide refresh button
            if (status === 'success' || status === 'error') {
                elements.refreshLocationBtn.style.display = 'flex';
                elements.refreshLocationBtn.className = status === 'success' ? 'btn btn-success' : 'btn btn-error';
            } else {
                elements.refreshLocationBtn.style.display = 'none';
            }
            
            // Update page title dynamically
            if (status === 'success') {
                document.title = currentLanguage === 'ar' ? 
                    'تم العثور على موقعك - أقرب فرع LG' : 
                    'Location Found - Nearest LG Branch';
            }
        };

        /**
         * Get user's location
         */
        const getUserLocation = () => {
            return new Promise((resolve, reject) => {
                const msg = messages[currentLanguage];
                
                if (!navigator.geolocation) {
                    reject(new Error(msg.locationUnavailable));
                    return;
                }

                updateLocationStatus(msg.locating);

                const options = {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 300000
                };

                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const location = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        
                        console.log('User location obtained:', location);
                        isLocationPermissionGranted = true;
                        updateLocationStatus(msg.locationSuccess, 'success');
                        
                        resolve(location);
                    },
                    (error) => {
                        console.error('Location error:', error);
                        
                        let errorMessage = msg.locationError;
                        switch (error.code) {
                            case error.PERMISSION_DENIED:
                                errorMessage = msg.locationDenied;
                                break;
                            case error.POSITION_UNAVAILABLE:
                                errorMessage = msg.locationUnavailable;
                                break;
                            case error.TIMEOUT:
                                errorMessage = currentLanguage === 'ar' ? 
                                    'انتهت مهلة تحديد الموقع' : 
                                    'Location timeout';
                                break;
                        }
                        
                        updateLocationStatus(errorMessage, 'error');
                        reject(new Error(errorMessage));
                    },
                    options
                );
            });
        };

        /**
         * Load branches data from JSON file with caching
         */
        const loadBranchesData = async () => {
            try {
                console.log('Loading branches data...');
                
                // Check cache first
                const cachedData = cacheManager.get();
                if (cachedData) {
                    console.log(`Loaded ${cachedData.length} branches from cache`);
                    return cachedData;
                }
                
                // Fetch data from the JSON file
                const response = await fetch('lg_branches_with_coords.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                console.log(`Loaded ${data.length} branches from server`);
                
                const validBranches = data.filter(branch => 
                    branch.lat && branch.lng && 
                    !isNaN(parseFloat(branch.lat)) && 
                    !isNaN(parseFloat(branch.lng))
                );
                
                console.log(`Valid branches: ${validBranches.length}`);
                
                if (validBranches.length === 0) {
                    throw new Error(messages[currentLanguage].noCoordinates);
                }
                
                // Cache the data
                cacheManager.set(validBranches);
                
                return validBranches;
            } catch (error) {
                console.error('Data loading error:', error);
                throw new Error(messages[currentLanguage].dataError);
            }
        };

        /**
         * Calculate distance between two geographic points using Haversine formula
         */
        const calculateDistance = (lat1, lon1, lat2, lon2) => {
            const R = 6371; // Earth's radius in kilometers
            const dLat = toRadians(lat2 - lat1);
            const dLon = toRadians(lon2 - lon1);
            
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                      Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
                      Math.sin(dLon / 2) * Math.sin(dLon / 2);
            
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            const distance = R * c;
            
            return Math.round(distance * 100) / 100;
        };

        const toRadians = (degrees) => degrees * (Math.PI / 180);

        /**
         * Format distance for display
         */
        const formatDistance = (distance) => {
            if (currentLanguage === 'ar') {
                if (distance < 1) {
                    return `${Math.round(distance * 1000)} متر`;
                }
                return `${distance} كم`;
            } else {
                if (distance < 1) {
                    return `${Math.round(distance * 1000)} m`;
                }
                return `${distance} km`;
            }
        };

        /**
         * Calculate distances and sort branches
         */
        const calculateAndSortBranches = (branches, userLoc) => {
            const branchesWithDistance = branches.map(branch => {
                const distance = calculateDistance(
                    userLoc.lat, 
                    userLoc.lng,
                    parseFloat(branch.lat),
                    parseFloat(branch.lng)
                );
                
                return {
                    ...branch,
                    distance: distance
                };
            });
            
            return branchesWithDistance.sort((a, b) => a.distance - b.distance);
        };

        /**
         * Get place name from coordinates using Nominatim (OpenStreetMap)
         */
        const getPlaceName = async (lat, lng) => {
            try {
                const language = currentLanguage === 'ar' ? 'ar' : 'en';
                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=${language}`
                );
                if (!response.ok) throw new Error("Error connecting to geocoding service");

                const data = await response.json();
                return data.display_name || (currentLanguage === 'ar' ? "موقع غير معروف" : "Unknown location");
            } catch (error) {
                console.error("Reverse geocoding error:", error);
                return currentLanguage === 'ar' ? "موقعك الحالي" : "Your current location";
            }
        };

        /**
         * Create nearest branch card
         */
        const createNearestBranchCard = (branch) => {
            const msg = messages[currentLanguage];
            return `
                <div class="branch-name">${branch.name}</div>
                <div class="branch-distance">
                    ${createIcon('distance')}
                    ${formatDistance(branch.distance)}
                </div>
                <div class="branch-info">
                    <div class="branch-address">
                        ${createIcon('location')}
                        ${branch.address}
                    </div>
                    <div class="contact-item">
                        ${createIcon('phone')}
                        ${branch.phone}
                    </div>
                    ${branch.maps_url ? `
                        <a href="${branch.maps_url}" target="_blank" rel="noopener noreferrer" class="maps-link" aria-label="${msg.viewOnMap} ${branch.name}">
                            ${createIcon('navigation')}
                            ${msg.viewOnMap}
                        </a>
                    ` : ''}
                </div>
            `;
        };

        /**
         * Update nearest branch card
         */
        const updateNearestBranch = (branch) => {
            elements.nearestCard.innerHTML = createNearestBranchCard(branch);
        };

        /**
         * Create branch card
         */
        const createBranchCard = (branch, index) => {
            const msg = messages[currentLanguage];
            return `
                <div class="branch-card card fade-in" role="listitem" aria-labelledby="branch-${index}" style="animation-delay: ${index * 0.1}s">
                    <div class="branch-name" id="branch-${index}">${branch.name}</div>
                    ${branch.distance ? `
                        <div class="branch-distance">
                            ${createIcon('distance')}
                            ${formatDistance(branch.distance)}
                        </div>
                    ` : ''}
                    <div class="branch-address">
                        ${createIcon('location')}
                        ${branch.address}
                    </div>
                    <div class="branch-contact">
                        <div class="contact-item">
                            <span class="contact-icon">${createIcon('phone')}</span>
                            <span>${branch.phone}</span>
                        </div>
                        <div class="contact-item">
                            <span class="contact-icon">${createIcon('location')}</span>
                            <span>${branch.district} - ${branch.governorate}</span>
                        </div>
                    </div>
                    ${branch.maps_url ? `
                        <a href="${branch.maps_url}" target="_blank" rel="noopener noreferrer" class="maps-link" aria-label="${msg.viewOnMap} ${branch.name}">
                            ${createIcon('navigation')}
                            ${msg.viewOnMap}
                        </a>
                    ` : ''}
                </div>
            `;
        };

        /**
         * Display results
         */
        const displayResults = async (sortedBranches) => {
            try {
                filteredBranches = sortedBranches;
                const msg = messages[currentLanguage];
                
                // Hide skeleton loading
                elements.loadingSkeletonSection.style.display = 'none';
                
                // Show nearest branch
                if (sortedBranches.length > 0 && sortedBranches[0].distance) {
                    const nearest = sortedBranches[0];

                    updateNearestBranch(nearest);
                    elements.nearestBranchSection.style.display = 'block';

                    // Update status message with user location + nearest branch
                    if (userLocation) {
                        const placeName = await getPlaceName(userLocation.lat, userLocation.lng);
                        elements.statusMessage.textContent = `${msg.youAreAt} ${placeName}`;
                        
                        elements.locationDetails.innerHTML = `
                            <strong>${msg.nearestIs}</strong><br>
                            ${nearest.name} (${formatDistance(nearest.distance)})
                        `;
                        elements.locationDetails.style.display = 'block';
                    }
                }
                
                // Show all branches
                renderBranches(sortedBranches);
                elements.allBranchesSection.style.display = 'block';
                
                // Update section title
                const allBranchesTitle = document.getElementById('all-branches-title');
                if (allBranchesTitle) {
                    allBranchesTitle.textContent = userLocation ? msg.allBranches : msg.allBranchesNoDistance;
                }
                
                console.log(`Displayed ${sortedBranches.length} branches`);
                
            } catch (error) {
                console.error('Display error:', error);
                showError(currentLanguage === 'ar' ? 'خطأ في عرض البيانات' : 'Error displaying data');
            }
        };

        /**
         * Render branches grid
         */
        const renderBranches = (branches) => {
            const branchesHTML = branches
                .map((branch, index) => createBranchCard(branch, index))
                .join('');
            
            elements.branchesGrid.innerHTML = branchesHTML;
        };

        /**
         * Filter branches based on search
         */
        const filterBranches = (searchTerm) => {
            if (!searchTerm.trim()) {
                renderBranches(filteredBranches);
                return;
            }

            const filtered = filteredBranches.filter(branch => 
                branch.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                branch.district.toLowerCase().includes(searchTerm.toLowerCase()) ||
                branch.governorate.toLowerCase().includes(searchTerm.toLowerCase()) ||
                branch.address.toLowerCase().includes(searchTerm.toLowerCase())
            );

            renderBranches(filtered);
            
            // Update results count for screen readers
            const resultsCount = filtered.length;
            elements.searchInput.setAttribute('aria-describedby', 'search-results');
            
            // Create or update results announcement
            let resultsAnnouncement = document.getElementById('search-results');
            if (!resultsAnnouncement) {
                resultsAnnouncement = document.createElement('div');
                resultsAnnouncement.id = 'search-results';
                resultsAnnouncement.className = 'sr-only';
                resultsAnnouncement.setAttribute('aria-live', 'polite');
                elements.searchInput.parentNode.appendChild(resultsAnnouncement);
            }
            
            resultsAnnouncement.textContent = currentLanguage === 'ar' ? 
                `تم العثور على ${resultsCount} نتيجة` : 
                `Found ${resultsCount} results`;
        };

        /**
         * Show/hide skeleton loading
         */
        const showSkeletonLoading = () => {
            elements.loadingSkeletonSection.style.display = 'block';
            elements.allBranchesSection.style.display = 'none';
            elements.nearestBranchSection.style.display = 'none';
        };

        const hideSkeletonLoading = () => {
            elements.loadingSkeletonSection.style.display = 'none';
        };

        /**
         * Show error
         */
        const showError = (message) => {
            elements.errorMessage.textContent = message;
            elements.errorSection.style.display = 'block';
            elements.nearestBranchSection.style.display = 'none';
            elements.allBranchesSection.style.display = 'none';
            hideSkeletonLoading();
        };

        /**
         * Hide error
         */
        const hideError = () => {
            elements.errorSection.style.display = 'none';
        };

        /**
         * Initialize the application
         */
        const initializeApp = async () => {
            try {
                showSkeletonLoading();
                hideError();
                
                console.log('Initializing app...');
                
                // Load branches data first
                branchesData = await loadBranchesData();
                
                try {
                    // Try to get user location
                    userLocation = await getUserLocation();
                    
                    // Calculate distances and sort branches
                    const sortedBranches = calculateAndSortBranches(branchesData, userLocation);
                    
                    // Display results
                    displayResults(sortedBranches);
                    
                } catch (locationError) {
                    console.warn('Location not available:', locationError.message);
                    
                    // Show all branches without distance sorting
                    filteredBranches = branchesData;
                    renderBranches(branchesData);
                    elements.allBranchesSection.style.display = 'block';
                    hideSkeletonLoading();
                    
                    // Update section title
                    const allBranchesTitle = document.getElementById('all-branches-title');
                    if (allBranchesTitle) {
                        allBranchesTitle.textContent = messages[currentLanguage].allBranchesNoDistance;
                    }
                }
                
            } catch (error) {
                console.error('App initialization error:', error);
                showError(error.message);
            }
        };

        /**
         * Retry location
         */
        const retryLocation = async () => {
            try {
                showSkeletonLoading();
                
                userLocation = await getUserLocation();
                
                const sortedBranches = calculateAndSortBranches(branchesData, userLocation);
                displayResults(sortedBranches);
                
                hideError();
                
            } catch (error) {
                console.error('Location retry failed:', error);
                updateLocationStatus(error.message, 'error');
                hideSkeletonLoading();
            }
        };

    /**
         * Event listeners setup
         */
        const setupEventListeners = () => {
            // Retry button
            elements.retryBtn.addEventListener('click', initializeApp);
            
            // Refresh location button
            elements.refreshLocationBtn.addEventListener('click', retryLocation);
            
            // Search functionality
            let searchTimeout;
            elements.searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterBranches(e.target.value);
                }, 300);
            });
            
            // Clear search on ESC key
            elements.searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    e.target.value = '';
                    filterBranches('');
                }
            });
        };

        /**
         * Performance optimization - Intersection Observer for lazy loading
         */
        const setupIntersectionObserver = () => {
            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add('fade-in');
                            observer.unobserve(entry.target);
                        }
                    });
                }, {
                    threshold: 0.1,
                    rootMargin: '50px'
                });

                // Observe branch cards when they're added
                const observeBranchCards = () => {
                    const branchCards = document.querySelectorAll('.branch-card:not(.observed)');
                    branchCards.forEach(card => {
                        card.classList.add('observed');
                        observer.observe(card);
                    });
                };

                // Set up mutation observer to watch for new cards
                const mutationObserver = new MutationObserver(() => {
                    observeBranchCards();
                });

                mutationObserver.observe(elements.branchesGrid, {
                    childList: true
                });
            }
        };

        /**
         * Keyboard navigation enhancement
         */
        const setupKeyboardNavigation = () => {
            // Add keyboard navigation for branch cards
            document.addEventListener('keydown', (e) => {
                if (e.target.classList.contains('search-input') && e.key === 'ArrowDown') {
                    const firstCard = elements.branchesGrid.querySelector('.branch-card a, .branch-card button');
                    if (firstCard) {
                        firstCard.focus();
                        e.preventDefault();
                    }
                }
            });
        };

        /**
         * Error handling and user feedback
         */
        const handleNetworkError = (error) => {
            console.error('Network error:', error);
            const msg = messages[currentLanguage];
            
            if (!navigator.onLine) {
                showError(currentLanguage === 'ar' ? 
                    'لا يوجد اتصال بالإنترنت. يرجى التحقق من الاتصال والمحاولة مرة أخرى.' : 
                    'No internet connection. Please check your connection and try again.'
                );
            } else {
                showError(msg.networkError);
            }
        };

        /**
         * Analytics and user engagement tracking (privacy-friendly)
         */
        const trackUserEngagement = () => {
            // Track location permission status (no personal data)
            if (isLocationPermissionGranted) {
                console.log('Location permission granted - enhanced experience enabled');
            }
            
            // Track search usage (no search terms stored)
            let searchCount = 0;
            elements.searchInput.addEventListener('input', () => {
                searchCount++;
                if (searchCount === 1) {
                    console.log('User engaged with search feature');
                }
            });
        };

        /**
         * Accessibility enhancements
         */
        const setupAccessibilityFeatures = () => {
            // Announce page changes to screen readers
            const announcePageChange = (message) => {
                const announcement = document.createElement('div');
                announcement.setAttribute('aria-live', 'polite');
                announcement.setAttribute('aria-atomic', 'true');
                announcement.className = 'sr-only';
                announcement.textContent = message;
                document.body.appendChild(announcement);
                
                setTimeout(() => {
                    document.body.removeChild(announcement);
                }, 1000);
            };

            // Announce when branches are loaded
            const originalDisplayResults = displayResults;
            window.displayResults = async (sortedBranches) => {
                await originalDisplayResults(sortedBranches);
                
                const msg = messages[currentLanguage];
                announcePageChange(
                    currentLanguage === 'ar' ? 
                    `تم تحميل ${sortedBranches.length} فرع` : 
                    `Loaded ${sortedBranches.length} branches`
                );
            };

            // Enhanced focus management
            document.addEventListener('focusin', (e) => {
                e.target.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            });
        };

        /**
         * Service Worker registration for caching (optional)
         */
        const registerServiceWorker = () => {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js')
                        .then(registration => {
                            console.log('SW registered: ', registration);
                        })
                        .catch(registrationError => {
                            console.log('SW registration failed: ', registrationError);
                        });
                });
            }
        };

        /**
         * Initialize everything when DOM is ready
         */
        document.addEventListener('DOMContentLoaded', () => {
            console.log('LG Branch Finder initialized');
            
            // Initialize core features
            themeManager.init();
            languageManager.init();
            
            // Set up event listeners
            setupEventListeners();
            
            // Set up accessibility and performance features
            setupIntersectionObserver();
            setupKeyboardNavigation();
            setupAccessibilityFeatures();
            
            // Track user engagement (privacy-friendly)
            trackUserEngagement();
            
            // Register service worker (optional)
            // registerServiceWorker();
            
            // Initialize the main application
            initializeApp().catch(error => {
                console.error('App initialization failed:', error);
                handleNetworkError(error);
            });
        });

        /**
         * Handle online/offline events
         */
        window.addEventListener('online', () => {
            console.log('Connection restored');
            hideError();
            if (branchesData.length === 0) {
                initializeApp();
            }
        });

        window.addEventListener('offline', () => {
            console.log('Connection lost');
            const msg = currentLanguage === 'ar' ? 
                'فقد الاتصال بالإنترنت. بعض الميزات قد لا تعمل.' : 
                'Internet connection lost. Some features may not work.';
            
            // Show a subtle notification instead of full error
            updateLocationStatus(msg, 'error');
        });

        /**
         * Handle page visibility changes (performance optimization)
         */
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Page is hidden, pause any ongoing operations
                console.log('Page hidden - pausing operations');
            } else {
                // Page is visible again
                console.log('Page visible - resuming operations');
                
                // Check if data is stale and refresh if needed
                if (cacheExpiry && Date.now() > cacheExpiry) {
                    console.log('Cache expired, refreshing data');
                    cacheManager.clear();
                    if (navigator.onLine) {
                        initializeApp();
                    }
                }
            }
        });

        /**
         * Handle memory warnings (mobile optimization)
         */
        if ('memory' in performance) {
            const checkMemoryUsage = () => {
                const memInfo = performance.memory;
                const usedMB = memInfo.usedJSHeapSize / 1048576;
                
                if (usedMB > 50) { // If using more than 50MB
                    console.warn('High memory usage detected, clearing cache');
                    cacheManager.clear();
                }
            };
            
            // Check memory usage periodically
            setInterval(checkMemoryUsage, 300000); // Every 5 minutes
        }

        /**
         * Export functions for testing (development only)
         */
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            window.lgBranchFinder = {
                calculateDistance,
                formatDistance,
                getUserLocation,
                loadBranchesData,
                themeManager,
                languageManager,
                cacheManager
            };
        }

        /**
         * Global error handler
         */
        window.addEventListener('error', (e) => {
            console.error('Global error:', e.error);
            
            // Don't show errors for non-critical issues
            if (e.error && e.error.message && 
                !e.error.message.includes('Network') && 
                !e.error.message.includes('fetch')) {
                return;
            }
            
            // Show user-friendly error message
            const msg = messages[currentLanguage];
            showError(msg.dataError);
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('Unhandled promise rejection:', e.reason);
            e.preventDefault();
            
            // Handle specific promise rejections
            if (e.reason && e.reason.message) {
                const msg = messages[currentLanguage];
                if (e.reason.message.includes('Location')) {
                    // Location errors are already handled
                    return;
                }
                showError(msg.dataError);
            }
        });
    </script>
</body>
</html>